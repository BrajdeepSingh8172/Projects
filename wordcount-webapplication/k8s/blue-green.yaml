apiVersion: v1
kind: List
items:

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: wordcount-blue
    labels:
      app: wordcount
      color: blue
  spec:
    replicas: 2
    selector:
      matchLabels:
        app: wordcount
        color: blue
    template:
      metadata:
        labels:
          app: wordcount
          color: blue
          active: "true" # initially active
      spec:
        containers:
          - name: wordcount
            image: ghcr.io/<OWNER>/<REPO>:latest
            ports:
              - containerPort: 3000

- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: wordcount-green
    labels:
      app: wordcount
      color: green
  spec:
    replicas: 2
    selector:
      matchLabels:
        app: wordcount
        color: green
    template:
      metadata:
        labels:
          app: wordcount
          color: green
          active: "false"
      spec:
        containers:
          - name: wordcount
            image: ghcr.io/<OWNER>/<REPO>:latest
            ports:
              - containerPort: 3000

- apiVersion: v1
  kind: Service
  metadata:
    name: wordcount-bluegreen-service
  spec:
    selector:
      app: wordcount
      active: "true"
    ports:
      - protocol: TCP
        port: 80
        targetPort: 3000
    type: LoadBalancer

# Usage notes:
# - The service routes to the pods whose `active` label is "true". Initially, `wordcount-blue` is active.
# - To switch traffic to green (after verifying green Deployment), patch labels:
#   kubectl label deployment wordcount-blue active=false --overwrite
#   kubectl label deployment wordcount-green active=true --overwrite
# - Replace image placeholders with your registry path (prefer per-release/image tag).
